<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Stuff</title>
    <link rel="stylesheet" href="css/style.css">
    <link id="css" rel="stylesheet" href="css/light.css">
    <style>
        body{
            overflow: hidden;
            max-width: inherit;
            width: 100%;
            margin: 0;
            padding: 0;
        }
        main{
            width: 40em;
            max-width: 40em;
            margin-left: auto;
            margin-right: auto;
            padding-top: 3em;
            padding-right: 3em;
            padding-left: 3em;
            height: 100vh;
        }
        h1{
            margin: 0;
        }
        canvas{
            position: absolute;
            top: 0px;
            left: 0px;
            z-index: -1;
            opacity: 0.2;
        }
                #perf{
            position: absolute;
            top: 0px;
            left: 0px;
            font-size: x-small;
            color: red;
        }
    </style>
</head>
<body>
<main>
    <span id="perf"></span>
    <h1>Stuff</h1>
    <h2><a href="cryptography.html">Cryptography Tools</h2>
    <h2><a href="websites.html">Cool websites</h2>
    <h2><a href="hello.html">Hello world!</h2>
    <h2><a href="cryptography.html">Cryptography Tools</a></h2>
    <h2><a href="websites.html">Cool websites</a></h2>
    <h2><a href="hello.html">Hello world!</a></h2>
    <script src="js/light.js"></script>
</main>
<canvas id="canvas"></canvas>
<script>
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
var array_size;
var array;
var pixel_size;

var pixel_scaling = 180;
var speed = 1;

function init(){
    canvas.width = document.documentElement.clientWidth;
    canvas.height = document.documentElement.clientHeight;
    pixel_size = canvas.width/pixel_scaling;
    array_size = [Math.ceil(canvas.width/pixel_size), Math.ceil(canvas.height/pixel_size)];
    array = [];
    for(var i = 0; i < array_size[0]; i++){
        array[i] = [];
        for(var j = 0; j < array_size[1]; j++){
            array[i][j] = Math.random() > 0.1 ? 0 : 1;
        }
    }
}

function update(){
        var t0 = performance.now();

    var copy_array = JSON.parse(JSON.stringify(array));
    var new_gen = [];
    for(var i = 0; i < array_size[0]; i++){
        new_gen[i] = [];
        for(var j = 0; j < array_size[1]; j++){
            var neighbours = 0;
            var alive = copy_array[i][j];

            var i2 = i+1;
            var i3 = i-1;
            var j2 = j+1;
            var j3 = j-1;

            if(i2 == array_size[0]){
                i2 = 0;
            }
            if(i3 == -1){
                i3 = array_size[0]-1;
            }
            if(j2 == array_size[1]){
                j2 = 0;
            }
            if(j3 == -1){
                j3 = array_size[1]-1;
            }

            neighbours += copy_array[i2][j];
            neighbours += copy_array[i2][j2];
            neighbours += copy_array[i2][j3];
            neighbours += copy_array[i3][j];
            neighbours += copy_array[i3][j2];
            neighbours += copy_array[i3][j3];
            neighbours += copy_array[i][j3];
            neighbours += copy_array[i][j2];


            if(alive){
                if(neighbours < 2 || neighbours > 3){
                    new_gen[i][j] = 0;
                }
                else{
                    new_gen[i][j] = 1;
                }
            }
            else if(!alive){
                if(neighbours == 3){
                    new_gen[i][j] = 1;
                }
                else{
                    new_gen[i][j] = 0;
                }
            }
        }
    }
    array = JSON.parse(JSON.stringify(new_gen));
    var t1 = performance.now();
    draw();
    var t2 = performance.now();
    document.getElementById("perf").innerHTML = "logic: "+(t1-t0)+"ms - draw: "+(t2-t1)+"ms - total: "+(t2-t0)+"ms";
}

function draw(){
    for(var i = 0; i < array_size[0]; i++){
        for(var j = 0; j < array_size[1]; j++){
            var p = array[i][j];
            if(theme == "dark"){
                if(p){
                    ctx.fillStyle = "white";
                }
                else{
                    ctx.fillStyle = "black";
                }
            }
            else{
                if(p){
                    ctx.fillStyle = "black";
                }
                else{
                    ctx.fillStyle = "white";
                }
            }

            ctx.fillRect(i*pixel_size, j*pixel_size, pixel_size, pixel_size);
        }
    }
}

init();
update();
setInterval(update, speed);
window.addEventListener("resize", function(){
    init();
});
document.body.addEventListener("mousemove", function(e){
    var x = Math.floor(e.clientX/pixel_size);
    var y = Math.floor(e.clientY/pixel_size);
    array[x][y] = 1;
    if(array[x][y-1] !== undefined){
        array[x][y-1] = 1;
    }
    if(array[x][y+1] !== undefined){
        array[x][y+1] = 1;
    }
    if(array[x+1] !== undefined){
        array[x+1][y] = 1;
        if(array[x+1][y+1] !== undefined){
            array[x+1][y+1] = 1;
        }
        if(array[x+1][y-1] !== undefined){
            array[x+1][y-1] = 1;
        }
    }
    if(array[x-1] !== undefined){
        array[x-1][y] = 1;
        if(array[x-1][y+1] !== undefined){
            array[x-1][y+1] = 1;
        }
        if(array[x-1][y-1] !== undefined){
            array[x-1][y-1] = 1;
        }
    }
});
</script>
</body>
</html>